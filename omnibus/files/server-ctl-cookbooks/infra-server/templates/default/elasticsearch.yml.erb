# This file generated by the Chef Infra Server. Any direct modifications
# will be lost on next reconfigure. You can tune elasticsearch
# via elasticsearch.* settings in /opt/opscode/chef-server.rb.
#
<%
# For more information, see configuration documentation at:
# https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-configuration.html
%>
cluster.name: <%= @cluster_name %>
node.name: <%= node['fqdn'] %>
path.data:  <%= @data_dir %>
path.logs: <%= @log_directory %>
# NOTE(ssd) 2020-05-21: This value must be quoted to handle values
# such as ::
network.host: "<%= @listen %>"
# Reference: http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-network.html
#            http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-gateway.html
#            http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery.html
http.port: <%= @port %>

<%
  # ES7 mandatory configuration.These settings are applicable only for the users using standalone or tiered configurations. 
  # For BYOD(external elasticsearch) none of the omnibus configs are applicable.
  # Note: we have not enabled bootstrap checks, so failing bootstrap checks will appear as warnings in the es logs.
  if node['private_chef']['elasticsearch']['es_version'].to_f > 7.0
%>
discovery.type: single-node
<%
  end
%>

<%
  # ES uses secomp in production mode. This is not supported in RHEL <  7
  # Reference:
  # https://www.elastic.co/guide/en/elasticsearch/reference/master/_system_call_filter_check.html
  # https://github.com/elastic/elasticsearch/issues/22899
  case node["platform_family"]
  when "rhel", "fedora"
    if node["platform_version"].to_f < 7.0
%>
bootstrap.system_call_filter: false
<%
    end
  end
%>


